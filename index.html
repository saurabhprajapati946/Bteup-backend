<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BTEUP Admit Card Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    background: #0d0d0d;
    color: #00ffcc;
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
}
.header {
    padding: 20px;
    background: #111;
    box-shadow: 0 0 15px #00ffcc;
    font-size: 24px;
    font-weight: bold;
}
.container {
    margin: 20px auto;
    width: 90%;
    max-width: 470px;
    background: #111;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 20px #00ffcc;
}
.btn {
    background: #00ffcc;
    color: #000;
    border: none;
    padding: 12px;
    width: 100%;
    font-size: 18px;
    border-radius: 8px;
    margin-top: 10px;
    cursor: pointer;
}
.btn:hover {
    opacity: 0.8;
}
input, select {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}
.footer {
    margin-top: 40px;
    padding: 20px;
    color: #00ffcc;
    background: #111;
    box-shadow: 0 0 15px #00ffcc;
    font-size: 14px;
}
.link-box {
    background: #000;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    word-wrap: break-word;
    border-left: 4px solid #00ffcc;
}
</style>
</head>

<body>

<div class="header">BTEUP Admit / Verification Card Generator</div>

<div class="container">

<h2>Select Card Type</h2>
<select id="cardType">
  <option value="admit">Admit Card</option>
  <option value="verification">Verification Card</option>
</select>

<h2>Mode</h2>
<select id="mode" onchange="toggleMode()">
  <option value="single">Individual</option>
  <option value="range">Range</option>
</select>

<div id="singleBox">
  <h3>Individual Enrollment</h3>
  <input id="singleRoll" placeholder="Enter Enrollment No. e.g. E24441132800054">

  <button class="btn" onclick="createSingleLink()">Create Link (Open)</button>
  <div style="height:10px"></div>

  <button class="btn" style="background:#00ff99;" onclick="downloadSinglePDF()">
    Download PDF (Backend)
  </button>

  <div id="singleLink" class="link-box"></div>
</div>

<div id="rangeBox" style="display:none;">
  <h3>Range Enrollment</h3>
  <input id="rangeStart" placeholder="Start Enrollment">
  <input id="rangeEnd" placeholder="End Enrollment">

  <button class="btn" onclick="generateRangeLinks()">Generate Links</button>
  <div style="height:10px"></div>

  <button class="btn" style="background:#00ff99;" onclick="downloadRangeZIP()">
    Download ZIP (Backend)
  </button>

  <div id="rangeLinks" class="link-box"></div>
</div>
</div>

<div class="footer" id="footerBox"></div>

<script>
// BACKEND URL
const backend = "https://bteup-admitcard.onrender.com";

// MODE SWITCH
function toggleMode() {
  const mode = document.getElementById("mode").value;
  document.getElementById("singleBox").style.display = mode === "single" ? "block" : "none";
  document.getElementById("rangeBox").style.display = mode === "range" ? "block" : "none";
}


// CREATE SINGLE LINK
function createSingleLink() {
  const roll = document.getElementById("singleRoll").value.trim();
  const type = document.getElementById("cardType").value;

  if (!roll) return alert("Enter enrollment number");

  const url = type === "admit"
      ? `https://bteup.ac.in/ESeva/Student/AdmitCard.aspx?EnrollNumber=${roll}`
      : `https://bteup.ac.in/ESeva/Student/verificationcard.aspx?EnrollNumber=${roll}`;

  document.getElementById("singleLink").innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
  window.open(url, "_blank");
}


// RANGE LINK GENERATOR
function generateRangeLinks() {
  const start = document.getElementById("rangeStart").value;
  const end = document.getElementById("rangeEnd").value;
  const type = document.getElementById("cardType").value;

  if (!start || !end) return alert("Enter full range");

  const prefix = start.match(/\D+/)[0];
  const s = parseInt(start.match(/\d+/)[0]);
  const e = parseInt(end.match(/\d+/)[0]);
  const width = start.match(/\d+/)[0].length;

  let html = "";
  for (let i = s; i <= e; i++) {
      const roll = prefix + String(i).padStart(width, "0");
      const link = type === "admit"
        ? `https://bteup.ac.in/ESeva/Student/AdmitCard.aspx?EnrollNumber=${roll}`
        : `https://bteup.ac.in/ESeva/Student/verificationcard.aspx?EnrollNumber=${roll}`;
      html += link + "<br>";
  }
  document.getElementById("rangeLinks").innerHTML = html;
}


// ðŸ”¥ BACKEND SINGLE PDF
async function downloadSinglePDF() {
  const roll = document.getElementById("singleRoll").value.trim();
  const type = document.getElementById("cardType").value;

  if (!roll) return alert("Enter enrollment");

  const res = await fetch(`${backend}/api/pdf/single`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ roll, type })
  });

  if (!res.ok) return alert("Backend Error!");

  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement("a");
  a.href = url;
  a.download = `${roll}.pdf`;
  a.click();
}


// ðŸ”¥ BACKEND RANGE ZIP
async function downloadRangeZIP() {
  const start = document.getElementById("rangeStart").value.trim();
  const end = document.getElementById("rangeEnd").value.trim();
  const type = document.getElementById("cardType").value;

  if (!start || !end) return alert("Enter full range");

  const res = await fetch(`${backend}/api/pdf/range`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ start, end, type })
  });

  if (!res.ok) return alert("Backend ZIP Error!");

  const blob = await res.blob();
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `BTEUP_${start}_${end}.zip`;
  a.click();
}


// AUTO SEMESTER FOOTER
(function () {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth()+1;
  let sem;

  if (year >= 2027 && month >= 7) sem = "Passout 2027";
  else if (year === 2026 && month >=7) sem = "5th Semester";
  else if (year === 2026 && month <=6) sem = "4th Semester";
  else if (year === 2025 && month >=7) sem = "3rd Semester";
  else sem = "2nd Semester";

  document.getElementById("footerBox").innerHTML =
    `Â© Saurabh Prajapati<br>Electrical Engineering<br>${sem}<br>Student of SBPGP`;
})();
</script>

</body>
</html>